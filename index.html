<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>手機橫向時鐘</title>
  <meta name="theme-color" content="#0a0a0a" />
  <style>
    :root{
      --bg: #0b0c10;
      --fg: #e6e6e6;
      --muted: #9aa0a6;
      --accent: #7cc5ff;
      --gap: min(2.2vmin, 14px);
      --radius: 20px;
      --shadow: 0 8px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%;background:var(--bg);color:var(--fg);margin:0;font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";}
    .page{height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--gap);padding:calc(env(safe-area-inset-top, 0px) + var(--gap)) calc(env(safe-area-inset-right, 0px) + var(--gap)) calc(env(safe-area-inset-bottom, 0px) + var(--gap)) calc(env(safe-area-inset-left, 0px) + var(--gap));}
    .backdrop{position:fixed;inset:0;z-index:-1;background:linear-gradient(160deg, #0a0a0a, #12161f)}

    .clock-card{width: min(95vw, 100vh);padding: clamp(10px, 3vmin, 28px);border-radius: var(--radius);background: rgba(255,255,255,0.04);backdrop-filter: blur(10px);box-shadow: var(--shadow);display:flex;flex-direction:column;align-items:center;gap:calc(var(--gap)*0.8);border: 1px solid rgba(255,255,255,0.08);position:relative;}

    .time{display:flex;align-items:baseline;gap: clamp(8px, 2.2vmin, 22px);font-variant-numeric: tabular-nums;letter-spacing: 0.02em;}
    .hhmm{font-size: clamp(48px, 22vmin, 180px);line-height: 1; font-weight: 700;transition: transform 0.5s;}
    .colon{display:inline-block; animation: blink 1s steps(2,end) infinite; opacity: 0.8;transition: transform 0.5s;}
    @keyframes blink{50%{opacity:0.2}}
    .sec{font-size: clamp(20px, 8vmin, 64px);opacity:.9;transition: transform 0.5s;}

    .date-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:center;color:var(--muted);font-size: clamp(14px, 5vmin, 22px);transition: transform 0.5s;}

    .toolbar{display:flex;gap:var(--gap);flex-wrap:wrap;justify-content:center}
    .btn{border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:var(--fg);padding:10px 14px;border-radius:12px;cursor:pointer;font-size: clamp(12px, 3.8vmin, 16px);font-weight:600;backdrop-filter: blur(6px);transition: transform 0.5s;} 
    .btn:hover{background:rgba(255,255,255,.12)}
    .btn[aria-pressed="true"]{outline:2px solid var(--accent);}

    .status{display:flex;gap:12px;align-items:center;color:var(--muted);font-size: clamp(12px, 3.8vmin, 16px);transition: transform 0.5s;}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block;vertical-align:middle;margin-right:6px;background:var(--warn)}

    .battery{display:flex;align-items:center;gap:8px}
    .battery-bar{width:64px;height:12px;border-radius:6px;border:1px solid rgba(255,255,255,.25);position:relative;overflow:hidden}
    .battery-fill{position:absolute;inset:1px;inset-inline-start:1px;width:0%;height:calc(100% - 2px);border-radius:5px;background:linear-gradient(90deg, #8bc34a, #4caf50)}

    .animal{position:absolute;bottom:10px;left:10px;font-size:24px;animation: hop 4s infinite;}
    @keyframes hop{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}

    .viewer-count{margin-top:10px;color:var(--muted);font-size:14px;}

    .rotate-hint{position:fixed;inset:0;display:none;place-items:center;text-align:center;padding:24px;background:rgba(0,0,0,.85);color:#fff;z-index:10}
    .rotate-hint .box{max-width:560px}
    .rotate-hint h2{margin:.2em 0 0.4em;font-size:22px}
    .rotate-hint p{margin:0;color:#d0d0d0}
    @media (orientation: portrait){ .rotate-hint{display:grid} }
    .critters{position:absolute;inset:auto 0 10px 0;display:flex;justify-content:center;gap:18px;pointer-events:none}
  .critters .critter{font-size: clamp(18px, 6vmin, 36px);filter: drop-shadow(0 2px 6px rgba(0,0,0,.5));animation: float 3s ease-in-out infinite;transition: transform .5s;}
  .critters .critter:nth-child(2){animation-delay:.4s}
  .critters .critter:nth-child(3){animation-delay:.8s}
  @keyframes float{0%,100%{transform: translateY(0)}50%{transform: translateY(-6px)}}
  </style>
</head>
<body>
  <div class="backdrop" id="backdrop"></div>
  <div class="rotate-hint"><div class="box"><h2>請橫置手機</h2><p>本頁最佳顯示於橫向模式（Landscape）。</p></div></div>
  <main class="page" id="app">
    <section class="clock-card">
      <div class="time"><span class="hhmm" id="hh">00</span><span class="hhmm colon">:</span><span class="hhmm" id="mm">00</span><span class="sec" id="sec">00</span></div>
      <div class="date-row" id="dateRow">—</div>
      <div class="toolbar"><button class="btn" id="toggle-12h" aria-pressed="false">24小時制</button><button class="btn" id="toggle-sec" aria-pressed="true">顯示秒</button></div>
      <div class=\"status\" id=\"statusRow\">
        <span id=\"tz\">—<\/span>
        <span id=\"viewBox\" style=\"margin-left:12px\"><span>瀏覽人數：</span><strong id=\"viewCount\">—<\/strong><\/span>
      <\/div>
      <div class=\"critters\" aria-label=\"小動物\">
        <span class=\"critter\" role=\"img\" aria-label=\"小貓\">🐱<\/span>
        <span class=\"critter\" role=\"img\" aria-label=\"小兔\">🐰<\/span>
        <span class=\"critter\" role=\"img\" aria-label=\"小雞\">🐤<\/span>
      <\/div>
      <div class="animal" id="animal">🐱</div>
      <div class="viewer-count" id="viewerCount">👀 瀏覽人數：0</div>
    </section>
  </main>

  <script>
    (function(){
      const elHH = document.getElementById('hh');
      const elMM = document.getElementById('mm');
      const elSS = document.getElementById('sec');
      const elDate = document.getElementById('dateRow');
      const elTZ = document.getElementById('tz');
      const btn12h = document.getElementById('toggle-12h');
      const btnSec = document.getElementById('toggle-sec');
      const viewBox = document.getElementById('viewBox');
      const viewCount = document.getElementById('viewCount');
      const critters = Array.from(document.querySelectorAll('.critter'));
      const animal = document.getElementById('animal');
      const viewerCount = document.getElementById('viewerCount');
      const LS_KEY = 'landscape-clock:v1';
      const state = Object.assign({ is12h:false, showSec:true }, JSON.parse(localStorage.getItem(LS_KEY) || '{}'));
      function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
      function pad(n){ return String(n).padStart(2,'0'); }
      function fmtDate(d){ const y=d.getFullYear(); const m=d.getMonth()+1; const da=d.getDate(); const day=d.getDay(); const names=['週日','週一','週二','週三','週四','週五','週六']; return `${y}年${m}月${da}日（${names[day]}）`; }
      function updateClock(){ const d=new Date(); let h=d.getHours(); if(state.is12h){ h=(h%12)||12; } elHH.textContent=pad(h); elMM.textContent=pad(d.getMinutes()); if(state.showSec){ elSS.textContent=pad(d.getSeconds()); elSS.style.display='inline-block'; } else { elSS.style.display='none'; } elDate.textContent=fmtDate(d); }
      setInterval(updateClock,1000); updateClock();
      function syncControls(){ btn12h.textContent = state.is12h ? '12小時制' : '24小時制'; btn12h.setAttribute('aria-pressed', String(state.is12h)); btnSec.textContent = state.showSec ? '顯示秒' : '隱藏秒'; btnSec.setAttribute('aria-pressed', String(state.showSec)); }
      syncControls();
      btn12h.addEventListener('click',()=>{state.is12h=!state.is12h;save();syncControls();updateClock();});
      btnSec.addEventListener('click',()=>{state.showSec=!state.showSec;save();syncControls();updateClock();});
      try { const tz=Intl.DateTimeFormat().resolvedOptions().timeZone||'本機時區'; elTZ.textContent=`時區：${tz}`; } catch(e){ elTZ.textContent='時區：本機'; }

      // 隨機文字移動效果，每兩分鐘觸發一次
      const textEls = [elHH, elMM, elSS, elDate, elTZ, btn12h, btnSec, ...critters];
      function randomShift(){
        textEls.forEach(el=>{
          const dir = Math.random() < 0.5 ? -1 : 1;
          el.style.transform = `translateX(${dir*10}px)`;
          setTimeout(()=>{el.style.transform = 'translateX(0px)';},1500);
        });
      }
      setInterval(randomShift, 120000);

      // 簡易瀏覽人數（使用 countapi.xyz 公共服務）。
      // 注意：若在本機 file:// 打開，會以 'local-demo' 作為 key，佈署到網路上後會自動改用網址。
      async function initCounter(){
        const host = location.host || 'local';
        const path = location.pathname || '/';
        const ns = 'landscape-clock';
        const key = encodeURIComponent(host + path) || 'local-demo';
        const today = new Date().toISOString().slice(0,10);
        const last = localStorage.getItem('vc_last');
        const base = `https://api.countapi.xyz`;
        try{
          let url = `${base}/get/${ns}/${key}`;
          if(last !== today){ // 今日首次瀏覽才 +1，避免同一裝置重複計次
            url = `${base}/hit/${ns}/${key}`;
            localStorage.setItem('vc_last', today);
          }
          const res = await fetch(url);
          const data = await res.json();
          if(data && (data.value !== undefined)){
            viewCount.textContent = data.value.toLocaleString();
          } else { throw new Error('no value'); }
        }catch(e){ viewBox.style.display='none'; }
      }
      initCounter();

      // 小動物隨機更換
      const animals = ['🐱','🐶','🐰','🐧','🐼','🐸','🐢','🦊','🦉'];
      function changeAnimal(){
        animal.textContent = animals[Math.floor(Math.random()*animals.length)];
      }
      setInterval(changeAnimal, 60000);
      changeAnimal();

      // 瀏覽人數模擬（需後端支援真實計數）
      let count = Math.floor(Math.random()*100)+1;
      viewerCount.textContent = `👀 瀏覽人數：${count}`;
    })();
  </script>
</body>
</html>
